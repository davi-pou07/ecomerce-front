<%- include("./../partials/head.ejs")%>


    <%- include("./../partials/nav.ejs")%>
        <div class="container">
            <article class="card">
                <div class="card-body">
                    <br>
                    <div class="row">
                        <aside class="col-md-6">
                            <div class="card">
                                <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-indicators">
                                        <%imagems.forEach((imagem,index)=>{%>
                                            <button type="button" data-bs-target="#carouselExampleCaptions"
                                                data-bs-slide-to="<%=index%>" class="active" aria-current="true"
                                                aria-label="Slide <%=index + 1%>"></button>
                                            <%})%>
                                    </div>
                                    <div class="carousel-inner">
                                        <%imagems.forEach((imagem,index)=>{%>
                                            <%if(index==0){%>
                                                <div class="carousel-item active">
                                                    <img src="<%=imagem.imagem%>" class="d-block w-100" height="400"
                                                        data-bs-interval="5000">
                                                </div>
                                                <%}else{%>
                                                    <div class="carousel-item">
                                                        <img src="<%=imagem.imagem%>" class="d-block w-100" height="400"
                                                            data-bs-interval="5000">
                                                    </div>
                                                    <%}%>
                                                        <%})%>

                                    </div>
                                </div>
                            </div> <!-- card img-big-wrap.// -->
                        </aside>
                        <main class="col-md-6">
                            <article>
                                <a href="/categoria/<%=categoria.id%>" class="text-primary btn-link">
                                    <%=categoria.titulo%>
                                </a>
                                <h3 class="title">
                                    <%=produto.nome%>
                                </h3>
                                <div>
                                    <p>
                                        <%=produto.descricao%>
                                    </p>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                        class="bi bi-archive" viewBox="0 0 16 16">
                                        <path
                                            d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1V2zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5H2zm13-3H1v2h14V2zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z" />
                                    </svg>
                                    <a href="#" class="btn-link  mr-3 text-muted"> Salvar na Lista de Desejos! </a>
                                </div>

                                <hr>

                                <div class="mb-3">
                                    <h6>Pequena Descri√ß√£o</h6>
                                    <ul class="list-dots mb-0">
                                        <li>Criado por </li>
                                        <li>Status: Ativo</li>
                                        <li>Material: </li>
                                    </ul>
                                </div>

                                <div class="form-group">
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                                        viewBox="0 0 512 512" width="30" height="30">
                                        <linearGradient id="a" gradientUnits="userSpaceOnUse" x1="256" x2="256"
                                            y1="5.766" y2="483.153">
                                            <stop offset="0" stop-color="#00efd1" />
                                            <stop offset="1" stop-color="#00acea" />
                                        </linearGradient>
                                        <g fill="url(#a)">
                                            <path
                                                d="m311.184 95.4a70.553 70.553 0 0 0 -45.184-26v-42.875a10 10 0 1 0 -20 0v42.855a69.829 69.829 0 0 0 -45.144 25.988l-65.979 83.332a41.781 41.781 0 0 0 -8.877 25.616v249.867a40.975 40.975 0 0 0 41.339 40.817h177.322a40.975 40.975 0 0 0 41.339-40.817v-249.867a41.814 41.814 0 0 0 -8.91-25.659zm-55.184 71.509a29.115 29.115 0 1 1 -29.115 29.114 29.148 29.148 0 0 1 29.115-29.114zm110 287.274c0 11.74-9.6 20.817-21.339 20.817h-177.322c-11.739 0-21.339-9.077-21.339-20.817v-249.867a21.646 21.646 0 0 1 4.592-13.247l65.938-83.294a49.99 49.99 0 0 1 29.47-18.089v58.249a49.115 49.115 0 1 0 20 0v-58.235a49.473 49.473 0 0 1 11.93 4.025 50.047 50.047 0 0 1 17.532 14.051l65.913 83.247a21.684 21.684 0 0 1 4.625 13.293z" />
                                            <path
                                                d="m256 330.983a13.432 13.432 0 0 1 13.417 13.417 10 10 0 0 0 20 0 33.476 33.476 0 0 0 -23.417-31.887v-4.36a10 10 0 0 0 -20 0v4.36a33.418 33.418 0 0 0 10 65.3 13.417 13.417 0 1 1 -13.417 13.417 10 10 0 0 0 -20 0 33.476 33.476 0 0 0 23.417 31.891v4.985a10 10 0 0 0 20 0v-4.985a33.418 33.418 0 0 0 -10-65.3 13.417 13.417 0 1 1 0-26.834z" />
                                        </g>
                                    </svg><label class="fs-5">Pre√ßo avaliado:</label>
                                </div>

                                <div class="mb-3 pt-2">
                                    <span class="form-control text-dark fw-bold">
                                        <%if(preco.desconto !=0){%>
                                            <s id="s" class="fs-6 text-danger"><%=preco.venda.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></s>
                                            <strong id="strong" class="fs-4"><%=preco.desconto.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></strong>
                                            <%}else{%>
                                                <strong id="strong" class="fs-4"><%=preco.venda.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></strong>
                                                <%}%>
                                    </span>
                                </div> <!-- price-detail-wrap .// -->

                                <div class="mb-4">
                                    <a href="#" class="btn btn-primary" onclick="gradeColuna($('#reflinha').val())">Compre agora!</a>
                                    <a href="#" class="btn btn-light" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal" onclick="gradeColuna($('#reflinha').val())">Adicionar ao Carrinho</a>
                                </div>

                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal" tabindex="-1"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Adicionar ao Carrinho
                                                </h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <input type="hidden" id="codItem" name="codItem"
                                                            value="<%=produto.id%>">
                                                        <%imagems.forEach((imagem,index)=>{%>
                                                            <%if(index==0){%>
                                                                <input type="image" class="mt-3"
                                                                    src="<%=imagem.imagem%>" alt="" height="120">
                                                                <%}%>
                                                                    <%})%>
                                                    </div>
                                                    <div class="col-md-8 text-center">
                                                        <h5>
                                                            <%=produto.nome%>
                                                        </h5>
                                                        <div class="row">
                                                            <label for=""
                                                                class="form-label text-center btn-light">Quantidade:</label>
                                                            <div class="col-md-12 text-center">
                                                                <button class="btn btn-danger" id="btnMenos"
                                                                    onclick="diminuir()">-</button>
                                                                <button class="btn btn-ligth" name="quantidade"
                                                                    value="1" id="btnValor">1</button>
                                                                <button class="btn btn-success" id="btnMais"
                                                                    onclick="adicionar()">+</button>
                                                            </div>
                                                            <%if(grades[0] !=undefined){%>
                                                                <label
                                                                    class="form-label text-center btn-light mt-2">Grades:</label>
                                                                <div class="col-md-6">
                                                                    <!-- üö®üö®üö®üö®üö®üö®üö®üö®üö®üö®üö®üö®üö®üö®üö® -->
                                                                    <!-- Validar a linha de acordo com a coluna -->
                                                                    <select name="reflinha" id="reflinha"
                                                                        class="form-select"
                                                                        onchange="gradeColuna(this.value)">
                                                                        <%var linhas=[];%>
                                                                            <%grades.forEach((grade,index)=>{%>
                                                                                <%var contem=1%>
                                                                                    <%for(x=0;x < index;x++){%>
                                                                                        <%if(linhas[x]==grade.reflinha){%>
                                                                                            <%var contem=0%>
                                                                                                <%}%>
                                                                                                    <%}%>

                                                                                                        <%if(contem
                                                                                                            !=0){%>
                                                                                                            <option
                                                                                                                value="<%=grade.reflinha%>">
                                                                                                                <%=grade.linha%>
                                                                                                            </option>
                                                                                                            <%}%>
                                                                                                                <%linhas.push(grade.reflinha)%>
                                                                                                                    <%})%>
                                                                    </select>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <select name="refcoluna" class="form-select"
                                                                        id="refcoluna">
                                                                        
                                                                    </select>
                                                                </div>
                                                                <%}else{%>
                                                                    <input type="hidden" id="reflinha" name="reflinha"
                                                                        value="0">
                                                                    <input type="hidden" id="refcoluna" name="refcoluna"
                                                                        value="0">
                                                                    <%}%>
                                                        </div>

                                                    </div>

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">Cancelar</button>
                                                <button type="button" data-bs-dismiss="modal" class="btn btn-primary"
                                                    onclick="AdicionarCarrinho()">Salvar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article> <!-- product-info-aside .// -->
                        </main> <!-- col.// -->
                    </div> <!-- row.// -->
                </div> <!-- card-body.// -->
            </article>
            <br>
            <div class="row mt-4 pt-5">
                <h3>Talvez lhe interesse:</h3>
                <%produtos.forEach(prod=>{%>
                    <%if(prod.categoriaId==categoria.id && prod.id !=produto.id){%>
                        <div class="col-md-3">
                            <figure class="card card-product-grid">
                                <a class="btn btn-outline-primary" href="/produto/<%=prod.id%>">
                                    <input type="hidden" id="produtoId" value="<%=prod.id%>">
                                    <div class="img-wrap">
                                        <%var imagem=imagens.find(imagem=> imagem.produtoId == prod.id)%>
                                            <%if(imagem !=undefined){%>
                                                <img class="rounded mx-auto d-block" src="<%=imagem.imagem%>"
                                                    width="120" height="120">
                                                <%}else{%>
                                                    <img class="rounded mx-auto d-block" src="/img/null.png" width="120"
                                                        height="120">
                                                    <%}%>
                                    </div>
                                    <figcaption class="info-wrap border-top">
                                        <span class="form-control text-center fw-bold text-dark bg-gradient bg-white">
                                            <%=prod.nome%>
                                                <%precos.forEach(preco=> {%>
                                                    <%if(preco.produtoId==prod.id){%>
                                                        <span
                                                            class="form-control text-white fw-bold bg-primary bg-gradient">

                                                            <%if(preco.desconto> 0){%>
                                                                <s id="s" class="fs-6 text-danger"><%=preco.venda.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></s>
                                                                <strong id="strong" class="fs-4"><%=preco.desconto.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></strong>
                                                                <%}else{%>
                                                                    <strong id="strong" class="fs-4"><%=preco.venda.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})%></strong>
                                                                    <%}%>
                                                        </span>
                                                        <%}%>
                                                            <%})%>
                                        </span>
                                    </figcaption>
                                </a>
                            </figure>
                        </div>
                        <%}%>
                            <%})%>
            </div>
        </div>

        <%- include("./../partials/footer.ejs")%>
            <script>
                function diminuir() {
                    var valor = document.getElementById("btnValor").innerHTML
                    if (valor > 1) {
                        document.getElementById("btnValor").innerHTML = parseInt(valor) - 1
                        document.getElementById("btnValor").value = parseInt(valor) - 1
                    }
                }
                function adicionar() {
                    var valor = document.getElementById("btnValor").innerHTML
                    if (valor >= 1) {
                        document.getElementById("btnValor").innerHTML = parseInt(valor) + 1
                        document.getElementById("btnValor").value = parseInt(valor) + 1
                    }
                }
            </script>
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script>
                
                function AdicionarCarrinho() {
                    var codItem = document.getElementById("codItem").value
                    var quantidadeItem = document.getElementById("btnValor").value
                    var reflinha = document.getElementById("reflinha").value
                    var refcoluna = document.getElementById("refcoluna").value
                    var myModal = document.getElementById('exampleModal')

                    axios.post("https://ecomerce-front.herokuapp.com/carrinho/adicionar", { codItem: codItem, quantidadeItem: quantidadeItem, refcoluna: refcoluna, reflinha: reflinha }).then(resp => {
                        alert(resp.data.resp)
                    })
                }

                function gradeColuna(linha) {
                    var codItem = document.getElementById("codItem").value
                    axios.get(`https://ecomerce-front.herokuapp.com/produto/${parseInt(codItem)}/${parseInt(linha)}/refcoluna`).then( resp => {
                        var colunas = resp.data.colunas
                        if (colunas != undefined) {
                            var refcoluna = document.getElementById("refcoluna")
                            refcoluna.innerHTML = ''
                            for (x = 0; x < colunas.length; x++) {
                                var option = document.createElement("option")
                                if (colunas[x] != undefined) {
                                    option.value = `${colunas[x].refcoluna}`
                                    option.innerHTML = `${colunas[x].coluna}`
                                    refcoluna.insertBefore(option, null);
                                }
                            }
                        }
                    })

                }
            </script>